## **TODO**

* ~~`データの正準形`をどうするか~~
    * ~~今は単純に`Compoonent`の初期値をまとめて管理するだけ~~
     * ~~??? `インターフェース`と`内部データの構造` の問題 (製作者は見た目だけを考える。一方システムは論理的な計算によってそれを成立させる必要がある) ???~~

* ~~移動系をどうするか~~
    * ~~カメラ基準~~
    * ~~ワールド基準~~
    *~~ プレイヤー基準~~

* ~~論理座標の可視化~~
    * ~~透かしでも点でもいいから表示しておくとやりやすい~~(2025/05/05)


---

* ~~データフローの課題。`論理`->`描画` の一貫性を保つべきか...~~
    * ~~論理座標(2D)における、プレイヤーキャラクターアクターを原点とした、マウスポインタ(スクリーン空間)の位置ベクトル~~ (2025/05/04) (glm::unProject)
    * **`論理`は`描画`によって初期化され、`描画`は`論理`の更新によって、結果を描画する
---

*  `PlayerCharacterActor`の操作ロジックの実装
    * ~~描画用データとゲームロジック用データの分離~~
        * ~~モデルの大きさと論理的な(矩形などの)大きさの整合のための`AssimpImporter`の処理の変更~~
            * ~~論理データと描画データは相対的に整合すればいい？~~
            * **絶対的整合と使い分けられるようにするべき**`ModelSizeComponent`？
            * ~~`AssimpImporter`で`ModelCenter`と`ModelSize`の計算と取得処理の実装~~
            * ~~論理スケールとモデルスケールを正確に対応付ける処理の実装~~
                * ~~描画スケールをベースにして論理スケールを決定する処理の実装 ~~
                
        * 論理データの初期化は、描画データのスケール、位置、回転などによって行う
            * <u> モデル正面から論理正面を**整合的に**自動で得る方法を考える</u>
        * ~~ゲームループでは、論理データを更新~~
        * ~~論理データの更新をもとに、描画データを更新する~~

    * ~~`Camera`への入力と`PlayerCharacterActor`への入力の分離~~
    * 



*~~ `GameUtils::Init...`の共通処理の関数化と責務の分離~~

* `Tilemap`の実装
    * ~~タイルマップを実装しデバッグ用描画を行う~~
        * ~~タイルマップについて
            * ~~タイルマップとは：ゲーム空間を`セル`に分割して管理する`論理的なグリッド`構造~~
            * ~~目的：空間管理(ナビ)、衝突処理、マップ編集／生成、ゲームルールの基盤、パスファインディング~~
            * <u>注意点：`行列構造->論理座標`、`論理座標->ヴィジュアル`の`同期`</u>
    
    * タイルマップ(行列構造)の最適な論理情報(論理座標など)としての保持と更新／扱い方を考える。
        * **<u> `行列構造`<->`(2D)論理座標`<->`描画座標`の関係(同期)を考える必要がある**</u>
            * ユーザは`描画座標`(による描画空間)を見て、(期待を持って)入力を行う
            * この入力は`論理座標`へ作用する

    * ~~`VisualMap`との連携をどうするか。~~
        * `トップビュー`では、トンネルなどの`同一XZ座標`における`複数Y座標`の表現や明快な操作は難しい(透かして表示などはできるかもだが)
        * だから今回は、`同一XZ座標`において必ず、`単一Y座標`であると仮定する.(トンネルや崖、地上／地下の階層構造や、オーバーハングの`論理的処理`は不可能(もしくは難しく複雑に)になる)
        * `描画`と`論理`の接合のために`HeightMap`を使用できないか。(任意の(X,Z)座標について、Yが定義されており、$f(X, Z) = Y$が成り立つ。)
        * `単位スケール`は、`1m`にする。`MIXAMO`の単位ユニットは`cm`らしいので、`0.01`倍して使うことになる...(はず)
        * `ベースメッシュ`・`障害物`・`飾り・小道具`に分けてインポートすることになる。
    * ~~`ベースメッシュ`から、`論理タイルマップ`を作成~~
        * `ベースメッシュ`の初期描画座標の中心を、論理タイルマップの初期化に反映する処理を実装
            * ~~*** 描画データによる論理データ初期化時に、回転を考慮しようとすると、スケール、回転中心、様々な誤差によるズレが生じる問題**~~
                * ~~論理タイルマップは論理空間における基準になる~~
                * ~~その他のオブジェクトはタイルマップに対する回転を考えて、近似する~~
                *~~ 回転した地形を覆うタイルマップの生成方法を考える~~
                * ~~近似のよい方法を考える~~
                * ~~`タイルマップ行列構造`と`ロジック座標(空間)`の責務分離を明確にする~~
        * ~~マップ上の静的オブジェクトから論理タイルマップの`属性`を指定する方法を考える~~
            * 


* ~~`障害物`の配置から`論理タイルマップ`の`ウォーカブル属性`などを(自動)初期化~~
    * ~~障害物の配置から論理タイルマップの属性初期化~~
    * 障害物のコリジョンの作成
        * 変な形状の障害物モデルについてもタイルマップできちんと近似できるようにする．(くねくねした形状とか半径が一定でない場合など)
    
* `Collision`を実装し、マップとプレイヤーキャラクターの衝突を検知、衝突箇所のデバッグ用描画
    * ~~小さい円の場合、コリジョン検出が重なっている部分が少ないとき検出できない問題。(`ceil`,`floor`で明示的にキャスト．また，$+-1$分だけ余分に走査するように変更)(**`glm::distance`はrootをとるため浮動小数点誤差が拡大する．**よって精密のために直接的に計算処理を記述)~~
    * `デバッグ用描画処理`を起点にコリジョン検出処理を呼び出す構造を改善し，`コリジョン検出処理`を起点に描画用処理を呼び出すようにする．




* ~~`CollisionSystem`データと処理の分離をしたい~~
    * [課題]：コリジョンリザルトデータの集積と，適切な展開を可能にするデータ構造と処理の実装（複数タイルに対する，別々の処理を可能にしたい．）

* `PlayerCharacterControlSysmte`の入力反映に関する問題
    * ~~`front`は更新されているが、`right`は更新されていない。修正する必要あり。~~

* デバッグ用描画システムの効率改善
    * `TileMap`のデバッグ描画について、**見えている範囲だけ**の描画を実行するように改善する

* `Collision`システムの実装
    * 論理データから、コリジョンに必要な半径などのデータを計算する処理の実装(簡単なハズ)




* 入力システムの構造の柔軟性の強化
    * ~~基礎構造`InputState`, `Update`という構造の限界~~(システムの基盤入力`RawInput`とゲーム用入力`InputActionComponent`の分離)
    * ゲームの`シーン`や`コンテキスト`に併せて同一入力に対する別動作を提供するシステムを考える
    * `ユーザ定義型`の入力定義を作成することで`GLFW依存`を解消し，マッピングを柔軟かつ動的に変更可能にする(`InputNameMapping`)
    * `JSON`ファイルに設定保存する機能を追加

## now 

* 攻撃判定処理の実装
    * `描画(3D)`と`論理(2D)`の整合性を確保し，柔軟かつ簡単に調整可能であることを目指す(描画と論理をあえてズラしたり)
        * ~~`SkillInstanceComponent`のライフタイムによる動的管理(作成／削除)の実装~~
            * ~~プリミティブなスキルの攻撃判定形状の情報を持つ，`Attack2DAreaComponent`のライフタイムによる動的管理の実装~~
            * ~~簡単なデバッグ描画の実装~~
        * 攻撃判定形状の複数の組み合わせや，時間経過による軌道的遷移，を可能にする処理および処理フローの構築
            * ~~`ローカル形状情報`と`ワールド変換情報`の分離~~
            * 
            * `ローカル情報`の最適化．`localcenter`や`localdirection`の情報がワールドの`回転処理`に副作用をもたらさないような工夫が必要
    * 定義していない`SkillID`について`SkillSlot`に割り当てようとすると，中身にゴミが入り，わかりにくいバグになってしまう現象の根本的な修正 (`SkillSlot`に割り当てた`SkillId`が `SkillDatabase` に登録されていない場合)

* カメラの初期化およびオフセットの処理の改善と調整
    * カメラの初期角度の整合性(Frontベクトルが、アクター生成時と更新で逆転する現象の修正)
    * 操作性と描画スタイルに合うように角度を調整

* **座標系を統一して回転計算やFrontベクトルなどの一貫性を保つようにリファクタリングする**

* システム構造の整理とフォルダ整理

* 簡易ゲームルール実装

* AI実装
    * モブの群れの`リーダーフォロワー制御`の実装

* `Entity`の世代管理システム，再利用システムの実装
    * `幽霊参照`の**構造的な**対策
        * `世代番号`の参照も持たせるとか

* `SceneManager`の実装
* `AssetsManager`の実装
* ``

* `AssimpImporter`のインポート時の、スケール設定の見直し.
    * `.fbx`形式のインポートがcmを仮定している可能性がある。

* `VISUALMAP`の実装
    * 

* コードの共通部分の抽象化による実装簡易化と効率化
    * ゲームオブジェクト生成テンプレートの作成
    * 


* 簡易的な即時UIの実装（デバッグ用座標を表示）
    * 


* 3DアニメーションのImportと描画機能の実装


* UIエンジンの実装


* サウンドエンジンの実装





* Shader(glsl)の高度化


* 最適化
    * ローダー／アンローダーシステムの実装
    * システムへの入力とキャラクター操作のための入力の分離：`InputState`
    * `Entity`と`Component`の**効率的な**動的管理システム



* インターフェース化




* **ゲームルール作成を支援するツールの作成**

* **シーン指向プロトタイピングを支援するツールの作成**
